<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/paper-card/paper-card.html">



<dom-module id="person-card">
    <template>
        <style is="custom-style">

        </style>
        <content>
            <paper-card class="custom-card">
                <div>
                    <paper-card heading="Profile Picture" image="http://placehold.it/350x150/FFC107/000000" alt="Profile Picture"></paper-card>
                </div>
                <div>
                    <iron-icon icon="account-circle" slot="prefix"></iron-icon>
                    <paper-card id="" class="cyan">
                        [[firstname]] [[lastname]]
                    </paper-card>
                    <template is="dom-if" if="[[showConnect]]">
                    <paper-button id="connectBtn" on-click="onClickConnect">Connect</paper-button>
                    </template>
                    <template is="dom-if" if="[[showAcceptReject]]">
                        <paper-button id="acceptBtn" on-click="onClickAccept">Accept</paper-button>
                        <paper-button id="rejectBtn" on-click="onClickReject">Reject</paper-button>
                    </template>
                    <template is="dom-if" if="[[showCancel]]">
                        <paper-button id="cancelBtn" on-click="onClickCancel">Cancel Request</paper-button>
                    </template>
                    <template is="dom-if" if="[[showRemove]]">
                        <paper-button id="removeBtn" on-click="onClickRemove">Remove Connection</paper-button>
                    </template>
                </div>
                <div>
                    <iron-icon icon="label" slot="prefix"></iron-icon>
                    <paper-card id= "status" class="cyan">
                        [[relationship]]
                    </paper-card>
                </div>
                <div>
                    <iron-icon icon="social:domain" slot="prefix"></iron-icon>
                    <paper-card class="cyan">
                        [[university]]
                    </paper-card>
                </div>
                <div>
                    <iron-icon icon="social:school" slot="prefix"></iron-icon>
                    <paper-card class="cyan">
                        [[major]]
                    </paper-card>
                </div>
                <div>
                    <iron-icon icon="book" slot="prefix"></iron-icon>
                    <paper-card class="cyan">
                        [[gpa]]
                    </paper-card>
                </div>
            </paper-card>
        </content>
    </template>
    <script>
        Polymer({
            is: 'person-card',
            properties:{
                firstname: String,
                lastname: String,
                university: String,
                major: String,
                gpa: String,
                personemail: String,
                relationship:  {type: String, observer: "relationshipObserver"},
                relstatus: {type: String, observer: "relStatusObserver"},
                token: String,
                email: String,
                showConnect: Boolean,
                showAcceptReject: Boolean,
                showCancel: Boolean,
                showRemove: Boolean,
                invitation: {type: String, observer: "invObserver"},
                localUrl: {type: String, value: "http://localhost:8080"},
                backendUrl: {type: String, value: "https://backend-dot-collabarter-188623.appspot.com"},
            },
            initialize: function(){
            },
            ready: function(){

            },


            decideAction: function(){
                 if((this.relstatus == null) || (this.invitation == null)){return;}
                 var ar,con,can,rem;
                 ar = false;
                 con = false;
                 can = false;
                 rem = false;
                 if(this.relstatus == "NOT CONNECTED"){
                    if(this.invitation){
                        ar = true;
                    }else{
                        con = true;
                    }
                 }else if(this.relstatus == "PENDING"){
                    can = true;
                 }else{
                     rem = true;
                  }

                 this.showAcceptReject = ar;
                 this.showConnect = con;
                 this.showCancel = can;
                 this.showRemove = rem;
            },


            onClickConnect: function(e){
               var u1 = this.localUrl + "/Connection";
               if(u1.includes("local")){
                    u1 = u1 + "?email=" + this.email;
               }
               var req1 = new XMLHttpRequest();
               var con;
               con = {"email": this.email,"person": this.personemail,"message": "Please Connect with me"}
               req1.open('POST',u1,true);
               req1.send(JSON.stringify(con));

            },

            onClickAccept: function(e){

            },

            onClickReject: function(e){

            },

            onClickCancel: function(e){

            },

            onClickRemove: function(e){

            },

            relationshipObserver: function(){
                //this.decideAction();
            },

            relStatusObserver: function(){
                this.decideAction();
            },

            invObserver: function(){
                this.decideAction();
            },

        });
    </script>
</dom-module>

